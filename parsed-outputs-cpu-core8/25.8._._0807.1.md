- Page 1 -

![Image](25.8._._0807.1.pdf__chunk_0000/page_0001/pictures_0.png)

## 뭨뺯 IP 폋켗 픛숓삏 PureCrypter  Formbook 핯왗싗 뫰몤 캧옻

폏핯 캧핯쩿퓿샻핌켷 퓿폫뭧

본 보고서는 2025 년 8 월 국가사이버안보센터(NCSC) 합동분석협의체를 통해 발간되었습니다 .

1

- Page 2 -

## 목차

| 1. 먗풏   .  ................................ ................................                                                                                  | ................................ ................   4  4   |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|
| 2. 퓿  뫰몤  쭿켘   .  ................................ ................................ ................................                                         | 5  5                                                       |
| 맻 .  뫰몤  먗풏솿   .  ................................ ................................ ................................ .....................                    | 5  5                                                       |
| 뺓 .  탬  핯졏핷   .  ................................ ................................ ................................ .....................                    | 5  5                                                       |
| 샟. PureCrypter 1   샟풯왗셏  ................................ ................................ ..............................                                     | 6  6                                                       |
| 앷. PureCrypter 2   핳혘   .  ................................ ................................ ................................                                 | ..   7  7                                                  |
| 1) 잧쾇킟 셫핯 쫰  ................................ ................................ ................................                                             | ................................   8                       |
| 2) PureCrypter 켟혐 셫핯 쫰   ................................ ................................ ................................ ................                | 8                                                          |
| 3) PureCrypter 켟혐 셫핯 뭧홫   ................................ ................................ ................................ ...................              | 9                                                          |
| 4) 켳쭻 쇔햌  ................................ ................................ ................................ ................................ ............... | 11                                                         |
| 쟃. Formbook 왗셏  ................................ ................................                                                                             | ................................ ............   2  21      |
| 1) Formbook 혐쫯 퀓ퟌ 쨊 퓋몤 좀옴 탟 좣싃   ................................ ................................ ............................                              | 23                                                         |
| 2) Formbook 탛 좣싃   ................................ ................................ ................................ ...............................         | 25                                                         |
| 3. 맻  퍀켬싗  쨊  폫뫻켬  쭿켘   .  ................................                                                                                                   | ................................ ........   2  26          |
| 맻 .  쇔핷  IP 폋켗  픛숓삏  퍀켬싗   .  ................................ ................................ ..................                                          | 2  26                                                      |
| 뺓 .  맻  C&C 켗쩿  ................................ ................................                                                                             | ................................ .............   2  28     |
| 샟. Kimsuky C&C 핳앷  폫뫻켬  ................................ ................................ .........................                                          | 2  29                                                      |
| 4. 몫왛   .  ................................ ................................                                                                                  | ................................ ..............   3  30    |
| 맻 .  샻핌  쨤퍃   .  ................................ ................................ ................................ ......................                    | 3  30                                                      |
| 1) 맻 핓탧킟엧풯 핯졏핷 쭻 핷 샟풯왗싗 쨊 탟 ힻ펌  ................................ ................................                                                           | ....   30                                                  |
| 뺓 .  쟃졫   .  ................................ ................................ ................................                                               | ...........................   3  30                        |
| 샟. MITRE ATT&CK  ................................ ................................                                                                            | ................................ .............   3  31     |
| 앷. IOCs   .  ................................ ................................ ................................                                               | ..............................   3  32                     |

![Image](25.8._._0807.1.pdf__chunk_0000/page_0002/pictures_1.png)

- Page 3 -

| 1) Hash   ................................ ................................ ................................ ................................ .......................   32   |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 2) C&C  ................................ ................................ ................................ ................................ .......................   32     |
| 3) Formbook URL  ................................ ................................ ................................ ................................ .......   32            |
| 4) Mutex  ................................ ................................ ................................ ................................ ....................   34      |
| 5) User-Agent  ................................ ................................ ................................ ................................ ............   34         |
| 6) Email   ................................ ................................ ................................ ................................ ......................   34   |

![Image](25.8._._0807.1.pdf__chunk_0000/page_0003/pictures_2.png)

- Page 4 -

## 1. 개요

2025년 5월경 국내 IP와 관련있는 다수의 RAR, EXE 파일이 발견되었다 . 네이버 관련 피싱 인프라로 의심되는 도메인이 해당 IP의 DNS 기록 조회를 통해 확인되었으며 , V VirusTotal에 네이버 로그인 관련 URL 질의 기록이 남아있다 .

[그림 1] 국내 IP 158.247.250[.]251 URL 질의 기록

![Image](25.8._._0807.1.pdf__chunk_0000/page_0004/pictures_3.png)

그중에 관련된 이메일 파일 , 해당 이메일 첨부 파일인 RAR, EXE 파일은 한국에서 보고되었으며 , 이메일을 수신한 이메일 계정 또한 한국 에너지 기업의 도메인이다. IP와 관련된 악성코드들은 한국 외에도 다양한 국가에 서로 다른 파일 이름으로 유포되었다 . 유포된 파일은 분석 결과 PureCrypter로 패킹된 Formbook 악성코드로 확인되었다 .

![Image](25.8._._0807.1.pdf__chunk_0000/page_0004/pictures_4.png)

- Page 5 -

## 2. 위협 공격 분석

## 가 . 공격 개요도

[그림 2] 공격 개요도

![Image](25.8._._0807.1.pdf__chunk_0000/page_0005/pictures_5.png)

## 나 . 피싱 이메일

초기 접근은 outlook 피싱 이메일을 전송한다 . 이메일 수신 도메인은 국내 에너지 기업 도메인으로 확인되었고 , 이메일에는 항공 화물 운송장으로 위장한 RAR 파일이 첨부되어 있다 .

![Image](25.8._._0807.1.pdf__chunk_0000/page_0005/pictures_6.png)

## [그림 3] 피해자에게 전달된 피싱 이메일 내용

이메일 발신자는 " noreplychleeportchlee@dhl.com " 이고 , 독일 소재 운송 업체 도메인을 사칭하였다 . 국제 운송 업체의 운송장 형태로 피싱 이메일을 전송하는 수법은 과거부터 위협 행위자들이 초기 침투 방법으로 1자주 이용해 왔다 .

1 https://www.estsecurity.com/enterprise/security-center/notice/view/303901

![Image](25.8._._0807.1.pdf__chunk_0000/page_0005/pictures_7.png)

- Page 6 -

## 다 . PureCrypter 1 차 다운로더

이메일 첨부 파일인 RAR 파일에는 EXE 파일이 압축되어 있고 , 압축 비밀번호는 설정되어 있지 않다 . 해당 EXE 파일은 상용 .NET 패커인 PureCrypter 의 첫 번째 스테이지로 확인되었다 .

상용 .NET 패커인 PureCrypter 는 2021 년부터 판매되어 수많은 악성코드 유포에 사용되었다 . 공격자는 Purecrypter 를 사용해 지속성 확보 방식과 인젝션 , 보안 알고리즘 우회 기법 등 다양한 공격 설정을 커스텀할 수 있다 . 공격자가 설정한 내용은 Newtonsoft.json 프레임워크를 통해 직렬화된 후 리소스 영역에 저장하며 , 실행 시 이를 역직렬화한 후 사용한다 .

어셈블리 이름은 " Utdmecyq.exe " 이며 , 내부에 오픈소스인 MonoTorrent 관련 클래스들과 실제 행위를 수행하는 RemoteExecuterApp 클래스가 존재한다 .

[그림 4] Utdmecyq.exe 내부 클래스

![Image](25.8._._0807.1.pdf__chunk_0000/page_0006/pictures_8.png)

RemoteExecuterApp 클래스에서 메인 로직이 실행되며 엔트리 포인트 또한 RemoteExecuterApp 클래스 내부에 존재한다 . 악성코드는 먼저 User -Agent 를 설정하여 C&amp;C 서버에 다운로드 요청을 보낸다 .

이는 C&amp;C 서버에 대한 요청을 정상적인 브라우저 요청으로 위장하여 보안 프로그램의 악성 행위 탐지를 회피하기 위한 시도로 보인다 .

[그림 5] 다운로드 요청 로직

다운로드 요청을 보내는 URL 과 User -Agent 는 아래와 같다 .

- -URL: hxxp://158.247.250[.]251/Gmfbssvfg.vdf
- -User -Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86\_64; rv:122.0) Gecko/20100101 Firefox/122.0

![Image](25.8._._0807.1.pdf__chunk_0000/page_0006/pictures_9.png)

- Page 7 -

## 국내 IP 에서 유포되는 PureCrypter 패킹 Formbook 페이로드 공격 사례

다운로드에 성공하면 , 다운받은 파일을 Base64 로 인코딩된 AES Key 와 IV 로 복호화한 뒤 메모리에 로드한다 . .

이후 Ts8mNZe9r3J0nu8Oa0.e4XQsmqqJcMfslpD8o 클래스의 pY8vRcOLI 메소드를 Invoke 한다

- -Base64 인코딩된 AES Key: eq78+DV08bw6vTK7GtbEEcXfM/7YWzVL50qlG2HSJkY=
- -Base64 인코딩된 AES IV: LqF17M9RPpHJCRbrkD6msw==

[그림 6] Utdmecyq.exe 메인 로직

## 라 . PureCrypter 2 차 인젝터

다운로드 후 복호화된 파일도 .NET 어셈블리 파일이며 , .NET Reactor 로 난독화되어 있다 .

[그림 7] 복호화된 .NET 파일 정보

![Image](25.8._._0807.1.pdf__chunk_0000/page_0007/pictures_10.png)

어셈블리 정보에서 Newtonsoft.Json 프레임워크 정보를 확인할 수 있고 , 이는 악성코드가 PureCrypter 를 이용한다는 것을 알 수 있다 .

![Image](25.8._._0807.1.pdf__chunk_0000/page_0007/pictures_11.png)

[그림 8] 복호화된 . NET 파일 어셈블리 정보

![Image](25.8._._0807.1.pdf__chunk_0000/page_0007/pictures_12.png)

- Page 8 -

## 1) 리소스 데이터 복호화

악성코드는 실행 후 먼저 리소스 영역의 데이터를 복호화한 뒤 Hash Table 형태로 저장한다 . 암호화 방식은 PureCrypter 패킹 시 DES, AES, TDES, Rijndael, RC2, 커스텀 블록 암호 중 선택할 수 있다 . 분석된 악성코드는 AES 를 사용한다 .

- -
- AES Key(16 진수 형태): A872738399912091389AE9720D5E068A0EF3B7D4C42B1FF24EA864F6C85683E9
- -AES IV(16 진수 형태): F96CF8CAFBAF112548F6F122D9270CCA

[그림 9] 리소스 데이터 복호화 로직

![Image](25.8._._0807.1.pdf__chunk_0000/page_0008/pictures_13.png)

복호화된 데이터는 악성코드 동작에 사용되는 여러 문자열로 , 문자열 테이블에 Key 값을 통해 문자열을 가져온다 .

리소스 이름 문자열을 추출한 뒤에 , Dnspy 의 watch 기능을 이용해 "AppDomin.CurrentDomain.GetData" 메소드를 호출하면 복호화된 문자열 테이블을 확인할 수 있다 .

[그림 10] 복호화된 문자열 테이블

![Image](25.8._._0807.1.pdf__chunk_0000/page_0008/pictures_14.png)

## 2) PureCrypter 설정 데이터 복호화

PureCrypter 는 인젝션 방식 및 타겟 프로세스 , 보안 기능 우회 여부 등을 설정할 수 있고 , 설정 데이터는 직렬화 및 AES 암호화되어 리소스 영역에 존재한다 . 악성코드 실행 시 리소스 영역에 존재하는 설정 정보를 동적으로 복호화 및 역직렬화하여 사용한다 .

![Image](25.8._._0807.1.pdf__chunk_0000/page_0008/pictures_15.png)

[그림 11] PureCrypter 설정 데이터 역직렬화 로직

![Image](25.8._._0807.1.pdf__chunk_0000/page_0008/pictures_16.png)

- Page 9 -

## 3) PureCrypter 설정 데이터 구조

데이터 인덱싱은 ProtoMember 기준으로 작성하였고 , " 페이로드 인젝션을 위한 설정 데이터 " , " 탐지 우회를 위한 설정 데이터 " , " 추가 기능을 위한 설정 데이터 " 가 존재한다 .

## n 페이로드 인젝션을 위한 설정 데이터

[표 1] 페이로드 인젝션을 위한 설정 데이터

|   ProtoMember | Description                                                                                  | Info           |
|---------------|----------------------------------------------------------------------------------------------|----------------|
|             1 | 인젝션 페이로드를 결정하는 플래그 (True 면 내부 데이터 로드 ,  False 이면 외부에서 다운로드 )                                 | True           |
|             2 | 인젝션 페이로드 또는 다운로드 URL 이 저장된 바이트 배열                                                            | Formbook  페이로드 |
|             3 | 악성코드가 실행되는 환경이 64bit 인지를 나타내는 플래그                                                            | False          |
|             4 | 페이로드 인젝션 방식을 결정하는 Enum 값 ( 0: .NET 어셈블리 로드 및 Invoke,  1: 프로세스 할로잉 ,  2: Reflective DLL 인젝션 ) | 1              |
|             5 | 실행 또는 페이로드를 인젝션할 타겟 프로세스 이름 문자열                                                              | Itself         |
|             6 | 인젝션한 페이로드 실행 시 전달되는 명령줄 인자 문자열                                                               | 존재하지 않음        |
|             7 | 부모 프로세스로 사용할 프로세스 이름 문자열                                                                     | explorer       |
|             8 | 사용되지 않는 값                                                                                    | Null           |
|             9 | 프로세스 생성 시 창 형태를 결정하는 DWORD 값                                                                 | 1              |

## n 탐지 우회를 위한 설정 데이터

|   ProtoMember | Description                                                    | Info     |
|---------------|----------------------------------------------------------------|----------|
|             1 | 악성코드 실행 중 SleepEx(999) 함수를 몇 번 호출할지 결정하는 변수                    | 0x15     |
|             2 | 뮤텍스 생성 여부를 결정하는 플래그                                            | False    |
|             3 | 뮤텍스 이름                                                         | Xlinulmx |
|             4 | Add - MpPreference 명령어를 이용한 악성코드 윈도우 디펜더 검사 제외 수행 여부를 결정하는 플래그 | False    |
|             5 | 시스템 및 프로세스 정보를 이용한 가상 머신 및 샌드박스 탐지 여부를 결정하는 플래그                | False    |
|             6 | 프로세스 핸들 복제 수행 여부를 결정하는 플래그                                     | False    |
|             7 | Ip release 또는 renew 명령어 실행 여부를 결정하는 플래그                        | False    |
|             8 | 추가로 실행할 파워쉘 스크립트 데이터                                           | Null     |
|             9 | 라이브러리 후킹 탐지 수행 여부를 결정하는 플래그                                    | False    |
|            10 | Amsi 우회 수행 여부를 결정하는 플래그                                        | False    |
|            11 | ETW 기반 탐지 우회 여부를 결정하는 플래그                                      | False    |
|            12 | 사용되지 않는 값                                                      | False    |

![Image](25.8._._0807.1.pdf__chunk_0000/page_0009/pictures_17.png)

- Page 10 -

|   13 | 자가 삭제 여부를 결정하는 플래그                      | False   |
|------|-----------------------------------------|---------|
|   16 | 추가로 실행할 파워쉘 스크립트 관리자 권한 실행 여부를 지정하는 플래그 | False   |

## [표 2] 탐지 우회를 위한 설정 데이터

## n 추가 기능을 위한 설정 데이터 – 지속성 확보 설정 데이터

|   ProtoMember | Description                                                             | Info      |
|---------------|-------------------------------------------------------------------------|-----------|
|             1 | 지속성 확보 방식을 결정하는 Enum 값 (0: 자동 실행 레지스트리 키 등록 , 1: 시작 프로그램 등록 , 2: 작업 등록) | 1         |
|             2 | 자가 복제 경로                                                                | %AppData% |
|             3 | 자가 복제 시 파일 이름                                                           | temp.exe  |
|             4 | 자가 복제 시 더미 바이트 추가 여부를 결정하는 플래그                                          | False     |

## [표 3] 추가 기능을 위한 설정 데이터 – 지속성 확보 설정 데이터

## n 추가 기능을 위한 설정 데이터 – MessageBox 출력 설정 데이터

|   ProtoMember | Description                              | Info   |
|---------------|------------------------------------------|--------|
|             1 | MessageBox 출력 시 경고 또는 정보 표시 여부를 지정하는 플래그 | Null   |
|             2 | MessageBox 로 출력되는 문자열                    | Null   |

## [표 4] 추가 기능을 위한 설정 데이터 – MessageBox 출력 설정 데이터

## n 추가 기능을 위한 설정 데이터 – 파일 생성 및 실행 설정 데이터

|   ProtoMember | Description             | Info   |
|---------------|-------------------------|--------|
|             1 | 생성 및 실행되는 파일 데이터        | Null   |
|             2 | 생성 및 실행되는 파일 이름         | Null   |
|             3 | 파일 생성 및 실행 여부를 지정하는 플래그 | Null   |
|             4 | 파일 생성 및 실행 여부를 지정하는 플래그 | Null   |

## [표 5] 추가 기능을 위한 설정 데이터 – 파일 생성 및 실행 설정 데이터

## n 추가 기능을 위한 설정 데이터 – GZIP 압축 설정 데이터

|   ProtoMember | Description            | Info   |
|---------------|------------------------|--------|
|             1 | 추가로 인젝션되는 GZIP 압축 페이로드 | Null   |

## [표 6] 추가 기능을 위한 설정 데이터 – GZIP 압축 설정 데이터

![Image](25.8._._0807.1.pdf__chunk_0000/page_0010/pictures_18.png)

- Page 11 -

## 4) 세부 동작

## n 뮤텍스 생성

역직렬화된 구 조체 멤 버에서 특 정 플래그를 검 사하여 , True 인 경우 뮤텍 스를 생성한다 . 분석된 악성코드는 플래그가 False 로 설정되어 있다 .

플래그가 True 일 때 는 , 뮤텍 스가 생성되면 15 초동안 뮤텍 스 획득 을 위하여 대기하고 , 실패하면 ipconfig 명령어를 실행해 IP 를 갱 신한다 . 뮤텍 스 이름은 아래와 같다 .

## -Xilnulmx

[ 그림 12] 뮤텍스 생성 로직

![Image](25.8._._0807.1.pdf__chunk_0001/page_0011/pictures_0.png)

## n 안티 VM 및 디버깅

아래 조 건 들을 확인하여 해당되는 경우 프로세스를 종료 한다 .

- -현 재 실행중인 프로세스에 SbieDll.dll, cuckoomon.dll 모 듈 이 포 함 된 경우
- -실행 환경 코어 수가 2 개 이하인 경우
- -현 재 실행중인 프로세스의 부모 프로세스 이름에 'cmd' 문자열이 포 함 된 경우
- -BIOS Version 및 SerialNumber 에 'Microsoft', 'VMWare', 'Virtual' 문자열이 포 함 된 경우
- -BIOS manufacturer 및 model 에 'Microsoft', 'VMWare', 'Virtual' 문자열이 포 함 된 경우
- -모 니 터 해상도가 낮 거나 32Bit 운영체제인 경우
- -사용자 이름이 'john', 'anna', 'xxxxxxxx' 인 경우
- -CheckRemoteDebuggerPresent() 메소드로 디 버거가 탐지된 경우

![Image](25.8._._0807.1.pdf__chunk_0001/page_0011/pictures_1.png)

- Page 12 -

## n IP Release

IP 주소 release 여부를 확인하고 release 되지 않은 경우 ipconfig 명령어를 실행해 IP 주소 할당을 해제한다 .

[ 그림 13] IP release 명령어 실행 로직

## n Amsi 우회

Amsi 검 사에 사용되는 AmsiScanBuffer 함 수 주소를 획득 한 후 메모리 권 한을 변 경한다 . 이후 함 수가 호출 될 때 Windows OS 비트 수에 따 라 특 정 값을 반 환하고 즉 시 종료 되도록 패 치 한다 .

[ 그림 14] AmsiScanBuffer 패치 로직

위 로직에서 'AmsiScanBuffer' 문자열을 로드하기 전에 , 문자열 안에 포 함 된 'Janroe' 을 제거한다 .

[ 그림 15] Janroe 제거 로직

![Image](25.8._._0807.1.pdf__chunk_0001/page_0012/pictures_2.png)

[ 그림 16] AmsiScanBuffer 문자열 로드 전 데이터

![Image](25.8._._0807.1.pdf__chunk_0001/page_0012/pictures_3.png)

- Page 13 -

## n ETW 기반 탐지 우회

Amsi 우회 방식과 동일한 방식으로 EtwEventWrite 함 수를 패 치 한다 . 다 만 AmsiScanBuffer 패 치 로직과 달리 문자열을 로드할 때 특 정 문자열을 제거하지 않는다 .

[ 그림 17] EtwEventWrite 패치 로직

![Image](25.8._._0807.1.pdf__chunk_0001/page_0013/pictures_4.png)

## n 안티 라이브러리 후킹

현 재 실행중인 프로세스에 로드된 ntdll.dll 또는 윈 도우 10 이상인 경우에는 kernel32.dll 을 %System% 폴더 의 원본 파일로 덮 어 쓴 다 . 현 재 프로세스의 dll 이 패 치 , 후킹 , 인젝션된 경우 원본 dll 로 복 원 하는 기능이다 .

[ 그림 18] 안티 라이브러리 후킹을 위한 라이브러리 복원 로직

![Image](25.8._._0807.1.pdf__chunk_0001/page_0013/pictures_5.png)

- Page 14 -

## n Windows Defender 검사 제외

현 재 실행중인 프로세스의 파일 경로가 '%AppData%\temp.exe' 인지 확인한다 . 경로가 다 르 면 Windows Defender 검 사 제외 목 적의 파워 쉘 스크 립 트를 base64 인코딩한 뒤 -enc 옵 션을 주어 실행한다 .

[ 그림 19] Windows Defender 검사 제외 로직

파워 쉘 스크 립 트 내용은 아래와 같다 . 행위는 현 재 실행중인 파일과 '%AppData%\temp.exe' 파일을 Windows Defender 검 사 제외 프로세스로 추가한다 .

```
Add-MpPreference -ExclusionPath {filepath}; Add-MpPreference -ExclusionProcess {filepath}; Add-MpPreference -ExclusionPath %appdata%\temp.exe; Add-MpPreference -ExclusionProcess %appdata%\temp.exe;
```

## n 파워쉘 스크립트 실행

구 조체 특 정 필 드에 저장된 파워 쉘 스크 립 트가 존재하면 , 특 정 플래그에 따 라 일 반 또는 관리자 권 한으로 파워 쉘 프로세스를 실행하고 인자로 전달해 실행한다 .

![Image](25.8._._0807.1.pdf__chunk_0001/page_0014/pictures_6.png)

[ 그림 20] 파워쉘 스크립트 실행 로직

![Image](25.8._._0807.1.pdf__chunk_0001/page_0014/pictures_7.png)

- Page 15 -

## n 파일 생성 및 실행

구 조체에 저장된 경로와 이름의 파일이 존재하지 않을 때 , 구 조체에 저장된 파일 데이터를 뒤 집 고 Gzip 압축 해제하여 생성한다 .

[ 그림 21] 파일 생성 및 실행 로직

![Image](25.8._._0807.1.pdf__chunk_0001/page_0015/pictures_8.png)

## n MessageBox 출력

현 재 실행중인 프로세스 실행 파일이 '%AppData%\temp.exe' 가 아 니 거나 '%Windows%' 하위 경로에 존재하지 않으면 구 조체 내 특 정 문자열을 MessageBox 로 출 력 한다 . 이 때 필 드 내 특 정 상수가 0 이면 경고 아이 콘 , 0 이 아 니 면 정보 아이 콘 을 출 력 한다 .

[ 그림 22] MessageBox 출력 로직

![Image](25.8._._0807.1.pdf__chunk_0001/page_0015/pictures_9.png)

## n 지속성 확보 및 자가 복제

현 재 실행중인 프로세스 실행 파일이 '%AppData%\temp.exe' 가 아 니 거나 '%Windows%' 하위 경로에 존재하지 않으면 , '%AppData%\temp.exe' 로 자가 복제한다 . 이 때 '%AppData%' 폴더 가 존재하지 않으면 폴더 를 생성한다 . 자가 복제 경로 및 파일 이름은 공격자가 설정 가능하다 .

![Image](25.8._._0807.1.pdf__chunk_0001/page_0015/pictures_10.png)

[ 그림 23] 자가 복제 로직

![Image](25.8._._0807.1.pdf__chunk_0001/page_0015/pictures_11.png)

- Page 16 -

## 국내 IP 에서 유포되는 PureCrypter 패킹 Formbook 페이로드 공격 사례

이후 구 조체에 저장된 값에 따 라 지속성 확보를 한다 .

- -0 인 경우 : '%AppData%\temp.exe' 경로를 'HKCR\Software\Microsoft\Windows\CurrentVersion\Run' 키 로 등록해 지속성을 확보한다 .

[ 그림 24] 자동 실행 레지스트리 등록 로직

- -1 인 경우 : 시작 프로그램에 '%AppData%\temp.exe' 를 실행하는 temp.vbs 파일을 생성 및 등록한다 .

![Image](25.8._._0807.1.pdf__chunk_0001/page_0016/pictures_12.png)

## [ 그림 25] 시작 프로그램 등록 로직

- -2 인 경우 : '%AppData%\temp.exe' 를 2~4 분 사이 주기로 실행하는 작업을 생성한다 .

[ 그림 26] 작업 생성 로직

지속성 확보 작업을 완료 하면 현 재 실행중인 프로세스 실행 파일을 '%AppData%\temp.exe' 파일로 복사한다 .

![Image](25.8._._0807.1.pdf__chunk_0001/page_0016/pictures_13.png)

- Page 17 -

## n 프로세스 핸들 복제

현 재 실행중인 프로세스의 핸 들을 explorer.exe 에 복제한다 . 이는 악성코드가 사용중으로 표 시되도록 하여 보안 프로그램이나 사용자 등이 파일을 삭 제하거나 수정할 수 없 다 .

[ 그림 27] 프로세스 핸들 복제 로직

## n 페이로드 인젝션

먼저 현 재 실행중인 프로세스가 관리자 권 한으로 실행되는 경우 DebugMode 에 진 입 한다 . 페이로드를 로드할 때 , 특 정 필 드 플래그에 따 라 내부에 저장된 데이터를 AES 복호화 및 Gzip 압축 해제하거나 URL 을 이용해 외부에서 다운로드한다 . 이 때 사용되는 AES Key 와 IV 는 리소스 데이터 복호화에 사용되는 값과 동일하다 .

[ 그림 28] 페이로드 로드 후 인젝션 수행 로직

![Image](25.8._._0807.1.pdf__chunk_0001/page_0017/pictures_14.png)

분석된 악성코드 내부에 암호화된 페이로드가 포 함 되어 있고 , 페이로드 인젝션 시 구 조체 내 특 정 값에 따 라 다른 방식을 사용한다 .

- -0 인 경우 : .NET 어셈블리 데이터를 메모리에 로드한 뒤 메소드로 호출한다 .

![Image](25.8._._0807.1.pdf__chunk_0001/page_0017/pictures_15.png)

[ 그림 29] .NET 어셈블리 로드 및 실행 로직

![Image](25.8._._0807.1.pdf__chunk_0001/page_0017/pictures_16.png)

- Page 18 -

## 국내 IP 에서 유포되는 PureCrypter 패킹 Formbook 페이로드 공격 사례

- -1 인 경우 : 프로세스 할로잉을 통해 페이로드를 인젝션한다 . 전달된 인자에 따 라 일 반 프로세스 할로잉과 부모 프로세스 스 푸핑 이후 할로잉을 진행한다 .

## [ 그림 30] 일반 프로세스 할로잉 로직

[ 그림 31] 부모 프로세스 스푸핑을 진행하는 할로잉 로직

![Image](25.8._._0807.1.pdf__chunk_0001/page_0018/pictures_17.png)

- Page 19 -

## 국내 IP 에서 유포되는 PureCrypter 패킹 Formbook 페이로드 공격 사례

- -2 인 경우 : 네이 티 브 쉘 코드를 메모리에 할당해 실행한다 . 전달된 인자에 따 라 현 재 실행중인 프로세스 또는 다른 프로세스에 로드 후 코드를 실행한다 .

## [ 그림 32] 현재 실행중인 프로세스 쉘코드 인젝션 로직

[ 그림 33] 다른 프로세스 쉘코드 인젝션 로직

분석된 악성코드는 explorer.exe 를 부모 프로세스로 위장하고 자기 자신에 프로세스 할로잉한다 .

![Image](25.8._._0807.1.pdf__chunk_0001/page_0019/pictures_18.png)

- Page 20 -

## n 압축 페이로드 인젝션

구 조체 내에 존재하는 특 정 데이터를 뒤 집 고 Gzip 압축 해제한 뒤 , 앞 선 쉘 코드 인젝션 방식을 사용해 특 정 프로세스에 인젝션한다 .

[ 그림 34] Gzip 압축 페이로드 인젝션 로직

## n 자가 삭제 및 실행 종료

파워 쉘 스크 립 트를 실행하여 자가 삭 제 및 현 재 실행중인 프로세스를 종료 한다 . 파워 쉘 스크 립 트 내용은 아래와 같다 .

- -Start-Sleep -Seconds 5; Remove-Item -Path '{filepath}' -Force

![Image](25.8._._0807.1.pdf__chunk_0001/page_0020/pictures_19.png)

[ 그림 35] 자가 삭제 및 실행 종료 로직

![Image](25.8._._0807.1.pdf__chunk_0001/page_0020/pictures_20.png)

- Page 21 -

## 마 . Formbook 로더

암호화되어 저장된 페이로드는 PE 파일이며 , 분석 결과 Formbook 악성코드로 확인되었다 .

[ 그림 36] PureCrypter 로 패킹된 페이로드 정보

![Image](25.8._._0807.1.pdf__chunk_0002/page_0021/pictures_0.png)

악성코드 동작 및 코드 영역 복호화 과정은 FORTINET 글 2 의 Formbook 악성코드와 유사하다 .

해당 유형의 Formbook 은 저수준 라이브러리를 동적으로 로드 후 사용하여 API 호출 과정을 은 닉 한다 . 이를 위해 ntdll.dll 파일 핸 들을 ZwCreateFile 로 가져와 , 메모리 내에 NtReadFile 로 저장 및 NtAllocateVirtualMemory 로 ERW 권 한을 부여한다 . 이후 ntdll.dll API 를 호출할 때마 다 해당 영역의 코드를 참 조한다 .

[ 그림 37] 메모리에 별도로 적재된 ntdll.dll

![Image](25.8._._0807.1.pdf__chunk_0002/page_0021/pictures_1.png)

ntdll.dll API 주소를 동적으로 가져와 호출하는 명령어에 전달된 레지스터 값과 인자를 분석하면 세부 동작을 확인할 수 있다 .

또한 전체 코드가 암호화되어 있어 악성코드 실행과 동시에 메인 로직의 복호화 및 점 프가 이 루 어진다 . 전체 코드가 복호화된 이후에도 주요 함 수는 암호화되어 있고 , 악성코드가 동작하면서 다음에 호출할 함 수를 복호화하고 , 함 수 호출 종료 이후 다시 암호화된다 .

악성 행위 수행 전에 디 버 깅 환경을 탐지하는 로직이 존재하며 , 탐지 과정에서 시스 템 정보를 로드한다 . 이 시스 템 정보는 이후 악성 행위에도 사용되며 , 따 라서 동적 분석 시 시스 템 정보 로드 까 지 정상 진행해 야 한다 . 안 티 디 버 깅 시 탐지하는 요소는 특 정 프로세스 이름 , 상위 폴더 이름 , 윈 도우 계정 이름 , 커 널 정보 클래스 등이다 .

[ 그림 38] 시스템 정보 저장 및 디버깅 탐지 로직

![Image](25.8._._0807.1.pdf__chunk_0002/page_0021/pictures_2.png)

2 https://www.fortinet.com/blog/threat-research/deep-analysis-formbook-new-variant-delivered-phishingcampaign-part-ii

![Image](25.8._._0807.1.pdf__chunk_0002/page_0021/pictures_3.png)

- Page 22 -

## 국내 IP 에서 유포되는 PureCrypter 패킹 Formbook 페이로드 공격 사례

탐지 로직이 종료 되면 Formbook 페이로드를 인젝션하기 위해 준비한다 . 이 과정에서 32bit 프로그램에서 64bit 코드로 전환하는 Heaven's Gate 기법을 사용한다 . 64bit 코드는 실행 시 점 에 따 라 다른 동작을 수행하며 , 로 더 에서 실행 시 다른 프로세스에 동일한 64bit 코드를 복사하고 실행한다 .

[ 그림 39] 64bit 코드로 점프하는 명령어

[ 그림 40] 실행되는 64bit 코드 의사 코드

다른 프로세스에 복사된 64bit 코드는 , 현 재 실행중인 프로세스의 자식 프로세스로 runonce.exe 파일을 실행한다 . 생성된 자식 프로세스는 부모 프로세스와의 공유 메모리 영역을 생성한다 .

[ 그림 41] 64bit 코드가 생성한 자식 프로세스

![Image](25.8._._0807.1.pdf__chunk_0002/page_0022/pictures_4.png)

64bit 코드 실행이 마무 리되고 32bit 코드가 다시 실행되면 , 로 더 프로세스가 앞 서 생성된 공유 메모리 영역을 이용하여 runonce.exe 프로세스에 Formbook 페이로드를 복사한다 . 이 때 ntdll.dll 의 스레드 관련 API 를 이용하여 RtlUserThreadStart 의 rax 레지스터를 조작하고 스레드를 재 개 해 인젝션한 페이로드가 실행되도록 한다 .

![Image](25.8._._0807.1.pdf__chunk_0002/page_0022/pictures_5.png)

- Page 23 -

## 1) Formbook 정보 수집 및 원격 명령 실행 모듈

runonce.exe 프로세스에 인젝션된 페이로드는 앞 선 로 더 와 동일하 게 전체 코드를 복호화하는 과정을 수행한다 . 복호화 이후 처 음 호출되는 함 수는 안 티 디 버 깅 로직을 수행한 뒤 , 주요 함 수를 호출한다 .

[ 그림 42] 디버깅 탐지 로직

![Image](25.8._._0807.1.pdf__chunk_0002/page_0023/pictures_6.png)

먼저 레지스트리 키 , advapi32.dll API 를 이용하여 시스 템 정보를 수 집 한다 . 수 집 한 정보는 ':' 로 구 분되며 , 암호화되어 저장된다 . 수 집 한 정보는 아래와 같다 .

- -Windows 정보
- -컴퓨 터 이름 (Base64 인코딩 )
- -사용자 이름 (Base64 인코딩 )

[ 그림 43] 메모리에서 확인한 정보

![Image](25.8._._0807.1.pdf__chunk_0002/page_0023/pictures_7.png)

수 집 정보는 아래 과정을 통해 암호화된다 .

1. RC4 암호화
2. Base64 인코딩
3. 접 두 사 'PKT2:' 붙 인 뒤 RC4 암호화

위 과정에서 사용되는 RC4 Key 는 아래와 같다 .

- -1 에서 사용되는 RC4 Key(16 진수 형태 ): 1DC0668A628EA91766A75C87319A23B24939C07B
- -3 에서 사용되는 RC4 Key(16 진수 형태 ): 3A665CF99A9B7A79F4FECB77BBE2BF5FF79687E3

정보 수 집 이후 64bit 코드를 한 번 더 호출하여 , explorer.exe 프로세스 하위 64bit 프로세스에 인젝션을 진행한다 . 이 때 삽입 된 페이로드는 Formbook 통신 모 듈 로 , C&amp;C 서버와 통신한다 .

인젝션 및 rip 조작 이후 , 32bit 코드로 돌 아오면 User Request 대기중인 스레드에 PostThreadMessageW 로 WM\_COMMAND 메세지를 보내 실행을 재 개 한다 . 추가로 인젝션된 페이로드는 , 기존 악성코드 엔트리와 다른 지 점 에서 작동하며 통신 모 듈 역할을 수행한다 .

![Image](25.8._._0807.1.pdf__chunk_0002/page_0023/pictures_8.png)

- Page 24 -

## 국내 IP 에서 유포되는 PureCrypter 패킹 Formbook 페이로드 공격 사례

인젝션 이후에는 정보 수 집 , 명령 수신 및 실행 로직을 반 복한다 . 정보 수 집 과정에서는 각종 레지스트리 값과 'Internet Explorer\IntelliFoms\Storage2' 등 브라우저와 이메일 정보를 수 집 한다 . 수 집 하는 정보는 아래와 같다 .

- -Windows 정보
- -이메일 프로 필 (Outlook, Thunderbird, Foxmail)
- -브라우저 (Internet Explorer, Firefox, Chrome 등 ) 개 인 정보
- -Windows Vault 자격 증 명

[ 그림 44] 정보 수집 로직

Chrome 브라우저 Login Data 의 경우 '%Temp%\IE13ci5' 파일로 복사한 뒤 sql 쿼 리로 데이터를 추출한다 .

[ 그림 45] Login Data 복사 로직

수 집 한 정보는 앞 서 64bit 프로세스에 인젝션한 통신 모 듈 과의 공유 메모리에 저장되고 , C&amp;C 서버와 통신할 때 Base64 인코딩되어 전송된다 .

Formbook 은 C&amp;C 서버에서 데이터를 받아 원 격 명령을 수행한다 . C&amp;C 서버에서 수신한 데이터는 공유 메모리에 저장하고 , 데이터 맨 앞 에 'XLNG' 문자열이 존재할 경우 바로 다음 바이트를 opcode 로 사용한다 .

[ 그림 46] 패킷 검사 로직

![Image](25.8._._0807.1.pdf__chunk_0002/page_0024/pictures_9.png)

명령 식 별 자에 따 른 동작은 아래 표 와 같다 .

|   Command | Behavior                                            |
|-----------|-----------------------------------------------------|
|         1 | exe, dll, ps1 확장자를 가진 파일을 다운받아 %Temp% 폴더 에 저장한 뒤 실행 |
|         2 | PE 파일 다운로드 및 헤더 검증 후 %Temp% 폴더 에 저장한 뒤 실행           |
|         3 | 자가 삭 제 및 explorer.exe 재시작                           |
|         4 | exe 또는 ps1 파일을 %Temp% 폴더 에 다운받아 실행                  |
|         5 | 브라우저 데이터 ( 쿠키 , 로그인 정보 , 프로 필 , 세션 ) 수 집            |
|         6 | 시스 템 정보 수 집 (Windows, 사용자 이름 )                      |
|         7 | 시스 템 재부 팅                                           |
|         8 | 시스 템 종료                                             |
|         9 | 아 무 동작도 하지 않음                                       |

[ 표 7] 명령 식별자에 따른 동작

![Image](25.8._._0807.1.pdf__chunk_0002/page_0024/pictures_10.png)

- Page 25 -

## 2) Formbook 통신 모듈

64bit 프로세스에 인젝션된 페이로드는 C&amp;C 서버와 통신을 시도한다 . Formbook 악성코드는 실제 C&amp;C 서버 주소 뿐만 아 니 라 가 짜 C&amp;C 서버 주소를 저장하여 모 든 주소에 요청을 보내 실제 C&amp;C 서버 주소를 식 별 하기 어 렵게 한다 . 분석된 악성코드는 암호화된 C&amp;C 서버 도메인 및 경로를 16 개씩 복호화한다 .

[ 그림 47] 힙 메모리에 저장된 C&amp;C 서버 정보

![Image](25.8._._0807.1.pdf__chunk_0002/page_0025/pictures_11.png)

C&amp;C 서버로 전송되는 데이터는 복 잡 한 커스텀 암호화 이후 Base64 로 인코딩하여 전송된다 . 확인한 모 든 URL 은 ' Formbook URL ' 참 고 바 란 다 .

통신 모 듈 은 이 외에도 GetClipboardData API 로 가져온 클 립 보드 데이터를 공유 메모리에 저장하고 , C&amp;C 서버로 전송한다 . 클 립 보드 데이터는 runonce.exe 에서 동작중인 정보 수 집 모 듈 이 공유 메모리에 기록한 각종 정보와 함께 C&amp;C 서버로 전송된다 .

![Image](25.8._._0807.1.pdf__chunk_0002/page_0025/pictures_12.png)

[ 그림 48] 클립보드 데이터 수집을 위한 각종 함수 로드 로직

![Image](25.8._._0807.1.pdf__chunk_0002/page_0025/pictures_13.png)

- Page 26 -

## 3. 추가 악성코드 및 연관성 분석

## 가 . 동일한 IP 에서 유포되는 악성코드

추가 악성코드 확보 결과 동일한 IP 에서 파일을 다운받아 복호화하여 실행하고 , PureCrypter 가 적용된 악성코드를 확보하였다 . 악성코드 유포 방법은 알 수 없 었지 만 , 대부분 RAR 압축 파일 형태인 것을 보아 분석된 사 례 와 동일한 방식인 피싱 이메일로 유포된 것으로 보인다 .

확보한 악성코드에서 확인한 정보는 아래 표 와 같다 .

| 어셈블리 이름         | MD5                               | Base64 인코딩된 AESKey                             | Base64 인코딩된 AESIV         | User-Agent                                                                                    |
|-----------------|-----------------------------------|------------------------------------------------|---------------------------|-----------------------------------------------------------------------------------------------|
| ljwflx.exe      | 81bfe3b3204ede1fca418e 44aa19b310 | KnJ27qGTjAZZNKQe xmBuXSOnnFvFQv/B KoLXk48czKg= | +PNBK7GBbAf397zU xJVbQA== | AppleWebKit/537.36 (KHTML,likeGecko) Chrome/120.0.0.0                                         |
| Kahogdwhj.exe   | 52a321e48902b8fbd1e98 4d9bd15f278 | PDXdRECJmaHFmRr owwO11ODbcK9klmg 78nXy4Dd9VuE= | 3Dma78UCdly9DQH 6md97kw== | OPR/96.0.4693.80 Mozilla/5.0 (X11; Ubuntu;Linuxx86_64; rv:122.0) Gecko/20100101 Firefox/122.0 |
| Endolsydm.exe   | 310ebb7ca19ff9b75d405 4c340b0c82e | x1ehIEX7Pxv5/8qKPc 91WFsl+5PCPtjdaxJZ a0J05+c= | eCzZQvqLFuqZ5qiO 471g2g== | Android13;Pixel 7) AppleWebKit/537.36 (KHTML,likeGecko) Chrome/120.0.6099.19                  |
| lkdsnivzaem.exe | ca9cb7bb06398670abc6 d19186c336cd | auCoaTwzm/qB/9TA vmSm81zuddQ/sJbM ELul5a5ti6s= | oH8nCT02nAmvySg N5wye6g== | AppleWebKit/537.36 (KHTML,likeGecko) Chrome/120.0.0.0                                         |

[ 표 8] 각 악성코드 정보

![Image](25.8._._0807.1.pdf__chunk_0002/page_0026/pictures_14.png)

- Page 27 -

## 국내 IP 에서 유포되는 PureCrypter 패킹 Formbook 페이로드 공격 사례

C&amp;C 서버인 158.247.250[.]251 에서 디렉토 리 리스 팅 을 통해 파일들을 확인할 수 있었으며 , 6 월 3 일 까 지 파일이 수정되며 공격이 진행되었다 . 분석 당시 다운받을 수 있는 파일은 분석된 악성코드를 포 함 해 총 4 개 이며 , 이중 연 관된 1 차 다운로 더 가 확보되어 AES 복호화를 진행할 수 있는 파일은 분석된 파일 외에 하나가 더 존재한다 . C&amp;C 서버는 6 월 둘 째주 이후 접속할 수 없 었다 .

[ 그림 49] C&amp;C 서버 루트 디렉토리

![Image](25.8._._0807.1.pdf__chunk_0002/page_0027/pictures_15.png)

추가로 확보한 2 차 PureCrypter 로 더 는 , 분석된 악성코드와 동일하 게 .NET Reactor 를 이용하여 난독화되었다 .

[ 그림 50] Csxkd.dll 내부 클래스

![Image](25.8._._0807.1.pdf__chunk_0002/page_0027/pictures_16.png)

문자열 Hash Table 과 역직렬화된 데이터도 , 분석된 악성코드와 동일한 방법으로 확인할 수 있다 . 직렬화된 데이터 및 추가 악성코드 복호화에 사용되는 AES Key 와 IV 는 아래와 같다 .

- -Base64 인코딩된 AES Key: aOmN7DquQ0DhLOXV9UsPjyqVGWY5RNEE2rx2fcmP/pk=
- -Base64 인코딩된 AES IV: numBuSJgCDpuy8TlrrBsIg==

역직렬화된 데이터 중 뮤텍 스 이름은 아래와 같다 .

- -Ncppn

복호화된 추가 악성코드 또한 최종 적으로 분석된 사 례 와 동일한 Formbook 악성코드를 인젝션한다 .

6 월 마 지 막 주에는 업로드되었 던 파일들이 정리되고 , 루 트 경로에 admin.php 파일인 b374k 웹쉘 이 업로드된 것이 확인되었다 .

![Image](25.8._._0807.1.pdf__chunk_0002/page_0027/pictures_17.png)

[ 그림 51] 업로드된 b374k 웹쉘

![Image](25.8._._0807.1.pdf__chunk_0002/page_0027/pictures_18.png)

- Page 28 -

## 나 . 추가 C&amp;C 서버

사용된 User-Agent 를 기 반 으로 조사한 결과 , 비 슷 한 시기에 제작된 여러 .NET 다운로 더 가 확인되었다 . 확인된 파일들은 모 두 2025 년 4 월 이후에 등장하였으며 , 공격자가 구 축한 C&amp;C 서버는 물 론 침해된 웹 사이트나 공유 드라이브에 파일을 업로드하고 이를 다운받는 방식을 사용한다 . 또한 RAR 압축 외에도 ISO 이 미 지 , 7z 등 다양한 압축 형태로 배포되었다 .

그러나 PureCrypter 내부에 설정된 User-Agent 정보 만 으로 , 제작자가 동일한 악성코드임을 단 정하기에 어 려울 것으로 생 각 되었다 . 이에 따 라 분석된 사 례 와 동일한 ssl thumbprint 가 나타나는 C&amp;C 서버에서 유포된 Formbook 관련 탐지명이 존재하는 악성코드를 선 별 하였다 . 관련 C&amp;C 서버 주소는 아래와 같다 .

- -161.248.239[.]119
- -95.214.54[.]164
- -195.177.94[.]43
- -147.135.109[.]226

모 두 PureCrypter 로 패킹된 악성코드를 유포한 점 이 동일하지 만 , Formbook 외에도 SnakeKeylogger 등 다른 종류 의 악성코드를 유포한 사 례 3 도 알 려 져 있다 . 현 재는 대부분 접근 불 가능한 상태로 , 서버에 저장되어 있 던 최종 페이로드를 확인할 수 없 다 .

3 https://x.com/skocherhan/status/1912625695156510920

![Image](25.8._._0807.1.pdf__chunk_0002/page_0028/pictures_19.png)

- Page 29 -

## 다 . Kimsuky C&amp;C 인프라 연관성

C&amp;C 서버로 사용된 IP (158.247.250[.]251) 는 북 한 배후 공격 그 룹 인 Kimsuky 의 공격 인프라와 공통 점 이 다수 발견되었다 . 엔 키 화이트 햇 위협 연구팀 은 'Github 를 공격 인프라로 악용하는 Kimsuky 의 최 신 국내 공격 사 례 분석 4 ' 글 을 작성한 이후 관련 위협을 꾸 준 히 모 니 터 링 해 왔으며 공통 점 이 존재하는 XenoRAT C&amp;C 서버 (158.247.240[.]40) 를 발견하였다 . 공통 점 은 아래 표 와 같다 .

[ 표 9] C&amp;C 서버 공통점

| 특징              | 158.247.250[.]251                                               | 158.247.240[.]40                                                |
|-----------------|-----------------------------------------------------------------|-----------------------------------------------------------------|
| 웹쉘 경로           | /admin.php                                                      | /admin.php                                                      |
| 웹쉘 종류           | b374k                                                           | b374k                                                           |
| 주로 매 핑 된 도메인    | *.store                                                         | *.store                                                         |
| JARMFingerprint | 07d19d12d21d21d07c42d43d00000094 24803a662b126a748cf4f90707a33c | 07d19d12d21d21d07c42d43d00000094 24803a662b126a748cf4f90707a33c |
| ASN             | AS20473(AS-VULTR)                                               | AS20473(AS-VULTR)                                               |
| Country         | KR                                                              | KR                                                              |

추가로 158.247.250[.]251 은 'menavcorp[.]store', 'nidlip.onlinenservicesite[.]store' 등 네이버 피싱 목 적으로 보이는 도메인이 매 핑 된 기록이 존재한다 . Kimsuky 는 과거부터 '{ 네이버 관련 키 워드 }[.]store' 형식의 도메인을 자주 이용해왔다 5 .

[ 그림 52] VirusTotal 질의 결과

![Image](25.8._._0807.1.pdf__chunk_0002/page_0029/pictures_20.png)

4 https://www.enki.co.kr/media-center/blog/dissecting-kimsuky-s-attacks-on-south-korea-in-depth-analysis-ofgithub-based-malicious-infrastructure

5 https://hunt.io/blog/million-ok-naver-facade-kimsuky-tracking

![Image](25.8._._0807.1.pdf__chunk_0002/page_0029/pictures_21.png)

- Page 30 -

## 4. 결론

## 가 . 대응 방안

## 1) 출처가 의심스러운 이메일 첨부 파일 다운로드 및 실행 지양

이메일에 포 함 된 이 미 지에 한 글 이 있는 것으로 보아 공격자는 공격 대상을 한국 국적의 개 인으로 설정하고 초기 접근에 시도 했 다는 점 을 알 수 있다 . 또한 발신 이메일을 DHL 사의 공식 도메인으로 위장하고 , 실제 기업들의 자동 발신 이메일 주소에 자주 사용되는 'noreply' 문자열을 사용하여 피해자가 이메일을 의심하지 않도록 설계하였다 . 이와 같이 의심스러운 이메일을 수신한 경우 첨부 파일 다운로드 및 실행을 지양해 야 하며 , VirusTotal 등의 검 사 도 구 를 적 극 이용하여 압축 대상 파일의 악성 행위 여부를 확인해 야 한다 .

[ 그림 53] 이메일 내용

![Image](25.8._._0807.1.pdf__chunk_0002/page_0030/pictures_22.png)

그러나 이번 사 례 의 경우 첨부된 압축 파일에 암호가 설정되어 있지 않아 브라우저 등 파일 검 사 대상이 된다 . 압축 해제 시에도 exe 확장자가 그대로 노 출되어 보안 프로그램을 사용하는 사용자는 위 험 을 알아 챌 수 있다 .

## 나 . 마치며

본 보고서에서는 피싱 이메일을 통한 국내 IP 에서의 Formbook 악성코드 유포 사 례 를 분석하였다 . 최종 악성코드인 Formbook 은 PureCrypter 로 패킹되어 있으며 , 감염 시스 템 정보를 유출하고 원 격 명령을 받는다 . 분석된 사 례 의 경우 모 듈 형 다 단 계 Formbook 악성코드에 PureCrypter 까 지 적용하며 악성코드의 구 조를 더욱 복 잡 하 게 설계하였다 . 보안 및 탐지 기 술 이 점차 발전 함 에 따 라 , 은밀하면서도 악성 행위를 성공적으로 수행하기 위한 우회 기 술 도 계속해서 개 발되고 있다 .

또한 공격에 사용된 C&amp;C 서버에서 Kimsuky 공격 인프라와 공통 점 이 발견되었다 . 분석된 사 례 는 최 근 Kimsuky 공격 패 턴 과 전 반 적으로 차 이가 있고 , APT 그 룹 이 동일한 IP 를 지속적으로 사용하지 않을 가능성도 있기에 확신하기 어 렵 지 만 , 과거 네이버 피싱 도메인이 매 핑 된 점 , 동일한 유형 (b374k) 의 웹쉘 이 C&amp;C 서버에 존재한 점 , JARM Fingerprint 가 일 치 하는 점 등의 공통 점 을 근거로 볼 수 있다 .

피싱 이메일을 통해 여러 기업이나 기관을 사칭하여 악성코드를 유포하는 사 례 는 꾸 준 히 발견되고 있다 . 공격자들은 신 뢰 할 수 있는 대상임을 이용해 사용자의 경 각 심을 낮 추고 감염 을 유도하 므 로 , 개 인 및 조직 차원 에서 더욱 각별 한 주의와 철 저한 보안 대 응 이 요 구 된다 .

![Image](25.8._._0807.1.pdf__chunk_0002/page_0030/pictures_23.png)

- Page 31 -

## 다 . MITRE ATT&amp;CK

| Tactic            | ID        | Name                                                              |
|-------------------|-----------|-------------------------------------------------------------------|
| Initial Access    | T1566.001 | Phishing: Spearphishing Attachment                                |
| Execution         | T1059.001 | CommandandScriptingInterpreter: PowerShell                        |
| Execution         | T1059.003 | CommandandScriptingInterpreter: WindowsCommandShell               |
| Execution         | T1047     | WindowsManagementInstrumentation                                  |
| Execution         | T1204.002 | User Execution: Malicious File                                    |
| Persistence       | T1547.001 | Boot or LogonAutostart Execution: Registry RunKeys/Startup Folder |
| Defense Evasion   | T1027.002 | Obfuscated Files or Information: Software Packing                 |
| Defense Evasion   | T1027.014 | Obfuscated Files or Information: Encrypted/Encoded File           |
| Defense Evasion   | T1055.002 | Process Injection: Portable Executable Injection                  |
| Defense Evasion   | T1055.003 | Process Injection: Thread Execution Hijacking                     |
| Defense Evasion   | T1055.012 | Process Injection: Process Holowing                               |
| Defense Evasion   | T1134.001 | Access TokenManipulation:Token Impersonation/Theft                |
| Defense Evasion   | T1140     | Deobfuscate/Decode Files or Information                           |
| Defense Evasion   | T1497.001 | Virtualization/Sandbox Evasion:System Checks                      |
| Defense Evasion   | T1622     | DebuggerEvasion                                                   |
| Defense Evasion   | T1070.010 | Indicator Removal: RelocateMalware                                |
| Discovery         | T1057     | Process Discovery                                                 |
| Discovery         | T1082     | SystemInformation Discovery                                       |
| Collection        | T1115     | Clipboard Data                                                    |
| Collection        | T1005     | Data from LocalSystem                                             |
| CommandandControl | T1095     | Non-Application Layer Protocol                                    |
| CommandandControl | T1071     | Application Layer Protocol: WebProtocols                          |
| CommandandControl | T1665     | Hide Infrastructure                                               |
| CommandandControl | T1132.001 | DataEncoding: Standard Encoding                                   |

![Image](25.8._._0807.1.pdf__chunk_0003/page_0031/pictures_0.png)

- Page 32 -

## 라 . IOCs

## 1) Hash

- ∞ e78be07019dfaf682c601985ac3ba424
- ∞ 108b5fd1b62489fd5cdb4ebd4a463226
- ∞ 42d24ccfb0a05c5f299181ca3afc7ae3
- ∞ a6c26a0b5df0db6a35b15c24342f27f8
- ∞ 6e5198c3aae9005cc58d011a8c6f0bec
- ∞ 81bfe3b3204ede1fca418e44aa19b310
- ∞ 52a321e48902b8fbd1e984d9bd15f278
- ∞ 310ebb7ca19ff9b75d4054c340b0c82e
- ∞ ca9cb7bb06398670abc6d19186c336cd

## 2) C&amp;C

- ∞ 158.247.250[.]251
- ∞ 95.214.54[.]164
- ∞ 161.248.239[.]119
- ∞ 195.177.94[.]43
- ∞ 212.23.222[.]208
- ∞ 5.226.55[.]186
- ∞ 147.135.109[.]226
- ∞ 45.87.60[.]127
- ∞ 193.34.212[.]113
- ∞ 158.247.217[.]26

## 3) Formbook URL

- ∞ www.asymptote[.]fund/geqw
- ∞ www.u90hm[.]top/q3ld
- ∞ www.eufi[.]xyz/sk5i
- ∞ www.netbarg[.]com/r6jx
- ∞ www.ml[.]com/zh1t
- ∞ www.adoptados[.]pet/rnaj
- ∞ www.synergysynergyeqhu[.]lol/hjvu
- ∞ www.businessauth[.]xyz/9nn7
- ∞ www.realbigteeth[.]net/29f4

## 국내 IP 에서 유포되는 PureCrypter 패킹 Formbook 페이로드 공격 사례

|              | T1573.001   | Encrypted Channel: Symmetric Cryptography   |
|--------------|-------------|---------------------------------------------|
| Exfiltration | T1041       | ExfiltrationOverC2Channel                   |

[ 표 10] MITRE ATT&amp;CK

![Image](25.8._._0807.1.pdf__chunk_0003/page_0032/pictures_1.png)

- Page 33 -

## 국내 IP 에서 유포되는 PureCrypter 패킹 Formbook 페이로드 공격 사례

- ∞ www.cleartrek[.]top/e35m
- ∞ www.dekoratifcamfilmi[.]xyz/gxr6
- ∞ www.sanlou86[.]vip/4h4w
- ∞ www.tridentoutdoor[.]net/odp0
- ∞ www.bmf.gv[.]at/bmvd
- ∞ www.dgdetailing[.]pro/g9w4
- ∞ www.ogrex[.]org/w7hs
- ∞ www.teamx[.]club/egab
- ∞ www.df96w[.]top/oodw
- ∞ www.dubrovnik[.]services/8fpw
- ∞ www.gamevui[.]shop/84g1
- ∞ www.uwd64[.]top/p1wy
- ∞ www.iconimax[.]org/geqw
- ∞ www.parshmen[.]art/ym9z
- ∞ www.g50tz[.]top/cdm7
- ∞ www.goldenstreamzxy[.]pro/vvrb
- ∞ www.070bn[.]shop/panb
- ∞ www.later[.]info/trou
- ∞ www.imprint[.]boutique/eqc8
- ∞ www.honghuoq2l2[.]sbs/aa4d
- ∞ www.fabu2024b01[.]xyz/ow2j
- ∞ www.aishiteru4[.]click/wirg
- ∞ www.japp4[.]icu/2q9x
- ∞ www.agrimater[.]shop/o05o
- ∞ www.fmtuxu[.]top/hlfg
- ∞ www.new8838[.]win/7evm
- ∞ www.slayflu[.]xyz/n871
- ∞ www.thebriefingpod[.]media/hwu8
- ∞ www.lawson[.]co[.]jp/n307
- ∞ www.yourcredential[.]xyz/v4li
- ∞ www.donaldcoin[.]com/n66l
- ∞ www.novatek[.]tech/o29b
- ∞ www.gorillalegends[.]xyz/xgry
- ∞ www.babyhan64[.]shop/4s99
- ∞ www.artscriptor[.]info/a2d4
- ∞ www.cardo[.]work/am6j
- ∞ www.hirufm[.]lk/whj4
- ∞ www.h34ry[.]top/ssr8

![Image](25.8._._0807.1.pdf__chunk_0003/page_0033/pictures_2.png)

- Page 34 -

## 국내 IP 에서 유포되는 PureCrypter 패킹 Formbook 페이로드 공격 사례

- ∞ www.ztg86[.]top/3whz
- ∞ www.freedom[.]golf/ip3t
- ∞ www.kl3u2l[.]top/v5n7
- ∞ www.dagdijital[.]xyz/bhvz
- ∞ www.resolve[.]fitness/d7x3
- ∞ www.precisednutrition[.]net/z82q
- ∞ www.autorolluphub[.]xyz/ulhr
- ∞ www.mastermohamedfight[.]top/o7rb
- ∞ www.farcanarop[.]xyz/2p9m
- ∞ www.itmoh[.]town/hwcx
- ∞ www.sticker[.]business/728a
- ∞ www.arcade[.]plus/lvbq

## 4) Mutex

- ∞ Xilnulmx
- ∞ Ncppn

## 5) User-Agent

- ∞ Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36 OPR/96.0.4693.80
- ∞ Mozilla/5.0 (X11; Ubuntu; Linux x86\_64; rv:122.0) Gecko/20100101 Firefox/122.0
- ∞ Mozilla/5.0 (Linux; Android 13; Pixel 7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.6099.199 Mobile Safari/537.36

## 6) Email

- ∞ noreplychleeportchlee@dhl.com

![Image](25.8._._0807.1.pdf__chunk_0003/page_0034/pictures_3.png)

- Page 35 -

국내

한 사이버 공간을 만드는 기업

한 사이버 공간을 만드는 기업

한 사이버 공간을 만드는 기업

한 사이버 공간을 만드는 기업

한 사이버 공간을 만드는 기업

한 사이버 공간을 만드는 기업

한 사이버 공간을 만드는 기업

한 사이버 공간을 만드는 기업

한 사이버 공간을 만드는 기업

한 사이버 공간을 만드는 기업

한 사이버 공간을 만드는 기업

한 사이버 공간을 만드는 기업

한 사이버 공간을 만드는 기업

한 사이버 공간을 만드는 기업

한 사이버 공간을 만드는 기업

한 사이버 공간을 만드는 기업

한 사이버 공간을 만드는 기업

한 사이버 공간을 만드는 기업

한 사이버 공간을 만드는 기업

IP

에서

유포되는

PureCrypter

패킹

Formbook

![Image](25.8._._0807.1.pdf__chunk_0003/page_0035/pictures_4.png)

## 공격 기술로 더 안전한 사이버 공간을 만드는 기업

공격 기술로 더 안전한 사이버 공간을 만드는 기업

공격 기술로 더 안전한 사이버 공간을 만드는 기업

공격 기술로 더 안전한 사이버 공간을 만드는 기업

공격 기술로 더 안전한 사이버 공간을 만드는 기업

공격 기술로 더 안전한 사이버 공간을 만드는 기업

공격 기술로 더 안전한 사이버 공간을 만드는 기업

공격 기술로 더 안전한 사이버 공간을 만드는 기업

한 사이버 공간을 만드는 기업 주식회사 엔 키 화이트 햇 (ENKI Whitehat Co., Ltd) 공격 기술로 더 안전한 사이버 공간을 만드는 기업

공격 기술로 더 안전한 사이버 공간을 만드는 기업

공격 기술로 더 안전한 사이버 공간을 만드는 기업

한 사이버 공간을 만드는 기업 Tel. 02-402-1337 Fax. 02-402-1336 E-mail. info@enki.co.kr

한 사이버 공간을 만드는 기업

한 사이버 공간을 만드는 기업

한 사이버 공간을 만드는 기업

공격 기술로 더 안전한 사이버 공간을 만드는 기업

공격 기술로 더 안전한 사이버 공간을 만드는 기업

페이로드

공격

사례